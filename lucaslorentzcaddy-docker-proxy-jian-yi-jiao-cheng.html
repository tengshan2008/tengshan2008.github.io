<!DOCTYPE html>
<html lang="en">
<head>
          <title>Personal Blog - lucaslorentz/caddy-docker-proxy 简易教程</title>
        <meta charset="utf-8" />




    <meta name="tags" content="docker" />
    <meta name="tags" content="caddy" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://tengshan2008.github.com/">Personal Blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li class="active"><a href="https://tengshan2008.github.com/category/default.html">Default</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://tengshan2008.github.com/lucaslorentzcaddy-docker-proxy-jian-yi-jiao-cheng.html" rel="bookmark"
         title="Permalink to lucaslorentz/caddy-docker-proxy 简易教程">lucaslorentz/caddy-docker-proxy 简易教程</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2020-01-13T00:00:00+08:00">
      Mon 13 January 2020
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://tengshan2008.github.com/author/master.html">Master</a>
    </address>
    <div class="category">
        Category: <a href="https://tengshan2008.github.com/category/default.html">Default</a>
    </div>
    <div class="tags">
        Tags:
            <a href="https://tengshan2008.github.com/tag/docker.html">docker</a>
            <a href="https://tengshan2008.github.com/tag/caddy.html">caddy</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h1>lucaslorentz/caddy-docker-proxy 简易教程</h1>
<p><a href="https://github.com/lucaslorentz/caddy-docker-proxy">GitHub</a> <a href="https://hub.docker.com/r/lucaslorentz/caddy-docker-proxy/">DockerHub</a></p>
<h2>1. 什么是 caddy-docker-proxy</h2>
<p>使用 caddy 对 docker 网络进行代理。其本身也是一个 docker 容器。可以对当前 docker 网络中的容器做反向代理。实现子域名的绑定，同时网络服务容器不需要映射本地端口。</p>
<h2>2. 下载镜像</h2>
<div class="highlight"><pre><span></span>docker pull lucaslorentz/caddy-docker-proxy:latest
</pre></div>


<p>如果你是 arm 架构设备，例如树莓派，请使用其他镜像。</p>
<div class="highlight"><pre><span></span>docker pull lucaslorentz/caddy-docker-proxy:latest-arm32v6
</pre></div>


<h2>3. 运行容器</h2>
<p>容器开放 80, 443, 2015 端口用作反向代理。</p>
<div class="highlight"><pre><span></span>docker run --name caddy -d <span class="se">\</span>
    -p <span class="m">2015</span>:2015 <span class="se">\</span>
    -p <span class="m">80</span>:80 <span class="se">\</span>
    -p <span class="m">443</span>:443 <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    lucaslorentz/caddy-docker-proxy:latest-arm32v6 <span class="se">\</span>
    -agree -email example@mail.com <span class="se">\</span>
    -log stdout -docker-process-caddyfile
</pre></div>


<blockquote>
<p>-agree 表示同意 Let's Encrypt 的协议<br>
-email 如果未在 Caddyfile 中指定用于 TLS 的邮箱，将使用此处的邮箱地址<br>
-log 启用日志，输出在 stdout 中，通过 docker logs -f caddy 查看<br>
-docker-process-caddyfile 不知道有啥用</p>
</blockquote>
<h2>4. 举例</h2>
<p>运行一个 docker 容器网站。</p>
<div class="highlight"><pre><span></span>docker run --name<span class="o">=</span>flask-website -d <span class="se">\</span>
    -l caddy.address<span class="o">=</span>example.com <span class="se">\</span>
    -l caddy.targetport<span class="o">=</span><span class="m">8080</span> <span class="se">\</span>
    -l caddy.proxy.transparent<span class="o">=</span> <span class="se">\</span>
    -l caddy.tls<span class="o">=</span>example@mail.com <span class="se">\</span>
    username/image:latest
</pre></div>


<p>caddy 的更多配置方法见 <a href="https://github.com/lucaslorentz/caddy-docker-proxy">GitHub</a> 仓库</p>
<p>在 docker 网络中生成如下 Caddyfile 配置</p>
<div class="highlight"><pre><span></span><span class="err">example.com {</span>
<span class="err">  proxy / 172.17.0.7:8080 {</span>
<span class="err">    transparent</span>
<span class="err">  }</span>
<span class="err">  tls example@mail.com</span>
<span class="err">}</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>